"use strict";(()=>{var e={};e.id=120,e.ids=[120],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},72254:e=>{e.exports=require("node:buffer")},6005:e=>{e.exports=require("node:crypto")},47261:e=>{e.exports=require("node:util")},12781:e=>{e.exports=require("stream")},73837:e=>{e.exports=require("util")},42750:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>g,patchFetch:()=>f,requestAsyncStorage:()=>u,routeModule:()=>l,serverHooks:()=>p,staticGenerationAsyncStorage:()=>d});var n={};r.r(n),r.d(n,{GET:()=>i,POST:()=>c});var a=r(49303),s=r(88716),o=r(60670);let{GET:i,POST:c}=r(82027).handlers,l=new a.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/auth/[...nextauth]/route",pathname:"/api/auth/[...nextauth]",filename:"route",bundlePath:"app/api/auth/[...nextauth]/route"},resolvedPagePath:"E:\\FESP\\TeamProject\\GENISISU\\src\\app\\api\\auth\\[...nextauth]\\route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:u,staticGenerationAsyncStorage:d,serverHooks:p}=l,g="/api/auth/[...nextauth]/route";function f(){return(0,o.patchFetch)({serverHooks:p,staticGenerationAsyncStorage:d})}},97049:(e,t,r)=>{e.exports=r(23191).vendored["react-rsc"].ReactDOM},51749:(e,t,r)=>{e.exports=r(23191).vendored["react-rsc"].ReactServerDOMWebpackServerEdge},49303:(e,t,r)=>{e.exports=r(30517)},38238:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"ReflectAdapter",{enumerable:!0,get:function(){return r}});class r{static get(e,t,r){let n=Reflect.get(e,t,r);return"function"==typeof n?n.bind(e):n}static set(e,t,r,n){return Reflect.set(e,t,r,n)}static has(e,t){return Reflect.has(e,t)}static deleteProperty(e,t){return Reflect.deleteProperty(e,t)}}},95014:(e,t)=>{function r(e,t){let r;let n=e.split("/");return(t||[]).some(t=>!!n[1]&&n[1].toLowerCase()===t.toLowerCase()&&(r=t,n.splice(1,1),e=n.join("/")||"/",!0)),{pathname:e,detectedLocale:r}}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"normalizeLocalePath",{enumerable:!0,get:function(){return r}})},37847:(e,t)=>{function r(e){return e.replace(/\/$/,"")||"/"}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"removeTrailingSlash",{enumerable:!0,get:function(){return r}})},82027:(e,t,r)=>{r.d(t,{I8:()=>f,handlers:()=>d,zB:()=>p});var n=r(20162),a=r(80772),s=r(27703),o=r(8204),i=r(75770),c=r(41482),l=r.n(c);async function u(e){return await fetch("https://api.fesp.shop/auth/refresh",{headers:{"client-id":"02-genisisu",Authorization:`Bearer ${e}`}})}let{handlers:d,signIn:p,signOut:g,auth:f,unstable_update:h}=(0,n.ZP)({trustHost:!0,providers:[(0,a.Z)({credentials:{email:{},password:{}},async authorize(e){let t=await (0,i.login)(e);if(t.ok){let e=t.item;return{id:String(e._id),name:e.name,email:e.email,type:e.type,image:e.image&&"https://api.fesp.shop"+e.image,accessToken:e.token.accessToken,refreshToken:e.token.refreshToken}}throw new n.UC(t.message,{cause:t})}}),(0,s.Z)({clientId:process.env.GITHUB_CLIENT_ID,clientSecret:process.env.GITHUB_CLIENT_SECRET}),(0,o.Z)({clientId:process.env.GOOGLE_CLIENT_ID,clientSecret:process.env.GOOGLE_CLIENT_SECRET}),(0,s.Z)({clientId:process.env.GITHUB_CLIENT_ID,clientSecret:process.env.GITHUB_CLIENT_SECRET})],session:{strategy:"jwt",maxAge:86400},pages:{signIn:"/login"},callbacks:{async signIn({user:e,account:t,profile:r,credentials:n}){switch(console.log("callbacks.signIn",e,t,r,n),t?.provider){case"credentials":console.log("id/pwd 로그인",e);break;case"github":case"google":case"kakao":case"naver":case"genesis":console.log("OAuth 로그인",e);let a=null;try{let n={type:"user",loginType:t.provider,name:e.name||"",email:e.email||"",image:e.image||"",extra:{...r,providerAccountId:t.providerAccountId}},s=await (0,i.signupWithOAuth)(n);console.log("회원가입",s);let o=await (0,i.loginOAuth)(t.providerAccountId);if(o.ok)a=o.item,console.log(a);else throw Error(o.message)}catch(e){throw console.error(e),e}e.id=String(a?._id),e.type=a?.type,e.accessToken=a.token.accessToken,e.refreshToken=a.token.refreshToken}return!0},async jwt({token:e,user:t,trigger:r,session:n,account:a,profile:s}){console.log("jwt.user",t),t&&(e.id=t.id,e.type=t.type,e.accessToken=t.accessToken,e.refreshToken=t.refreshToken);let o=l().decode(e.accessToken),i=o?.exp?1e3*o.exp:0;if(Date.now()>i)try{console.log("토큰 만료됨.",Date.now()+" > "+i);let t=await u(e.refreshToken);if(t.ok){let r=await t.json();return{...e,accessToken:r.accessToken}}401===t.status&&console.log("리플래시 토큰 인증 실패. 로그인 페이지로 이동해야 함",await t.json())}catch(t){if(t instanceof Error)return console.error(t),{...e,error:t.message}}return"update"===r&&n&&(e.name=n.name),e},session:async({session:e,token:t})=>(console.log("session.user",e.user),e.user.id=t.id,e.user.type=t.type,e.accessToken=t.accessToken,e.refreshToken=t.refreshToken,e)}})},75770:(e,t,r)=>{r.r(t),r.d(t,{login:()=>u,loginOAuth:()=>p,signInWithCredentials:()=>l,signInWithGenesis:()=>f,signInWithGithub:()=>m,signInWithGoogle:()=>g,signInWithNaver:()=>h,signup:()=>c,signupWithOAuth:()=>d});var n=r(24330);r(60166);var a=r(82027),s=r(58585),o=r(40618);let i="https://api.fesp.shop";async function c(e){let t={type:e.get("type")||"user",name:e.get("name"),email:e.get("email"),password:e.get("password"),image:""},r=e.get("attach");if(r?.size>0){let r=await fetch(`${i}/files`,{method:"POST",headers:{"client-id":"02-genisisu"},body:e});if(!r.ok)throw Error("파일 업로드 실패");let n=await r.json();t.image=n.item[0].path}let n=await fetch(`${i}/users`,{method:"POST",headers:{"client-id":"02-genisisu","Content-Type":"application/json"},body:JSON.stringify(t)}),a=await n.json();return console.log("SignUp data",a),a}async function l(e){console.log("signInWithCredentials 로그인 결과",e);try{let t=await (0,a.zB)("credentials",{...e,redirect:!1});console.log(t)}catch(e){if(console.error(e),e instanceof Error)return e.cause}(0,s.redirect)("/")}async function u(e){return(await fetch(`${i}/users/login`,{method:"POST",headers:{"Content-Type":"application/json","client-Id":"02-genisisu"},body:JSON.stringify(e)})).json()}async function d(e){return(await fetch(`${i}/users/signup/oauth`,{method:"POST",headers:{"client-id":"02-genisisu","Content-Type":"application/json"},body:JSON.stringify(e)})).json()}async function p(e){return(await fetch(`${i}/users/login/with`,{method:"POST",headers:{"client-id":"02-genisisu","Content-type":"application/json"},body:JSON.stringify({providerAccountId:e})})).json()}async function g(e){await (0,a.zB)("google",{redirectTo:`/?email=${e.get("email")}`})}async function f(e){await (0,a.zB)("genesis",{redirectTo:`/?email=${e.get("email")}`})}async function h(e){await (0,a.zB)("naver",{redirectTo:`/?email=${e.get("email")}`})}async function m(e){await (0,a.zB)("github",{redirectTo:`/?email=${e.get("email")}`})}(0,o.h)([c,l,u,d,p,g,f,h,m]),(0,n.j)("e905d3c8a1f5ac6653a2daa334ae00bf5047ff6b",c),(0,n.j)("3f2e0afba8bab9307737612bc4fe62393f6f8283",l),(0,n.j)("c392c5e8e6a7f21d8b28003d01a1adb46c73f41b",u),(0,n.j)("cf612f4ff735cf9171a8c18a7b16ee823dea3b48",d),(0,n.j)("1d018a760d76feb09159736044f8836211e49fe8",p),(0,n.j)("edbafd7d2562715704ce4c02c62cf66a75536949",g),(0,n.j)("590b59c73117bc6cabda72a86624a10b5ae14a3d",f),(0,n.j)("5c6c14ce6624afdcc210a7e9d92cc5025dc41925",h),(0,n.j)("fbbd04a16abba95936ca55123dd6e3fac683d9b8",m)}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[948,81],()=>r(42750));module.exports=n})();